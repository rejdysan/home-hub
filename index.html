<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home Hub Dashboard</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #38bdf8;
            --system-text: #94a3b8;
        }

        body {
            font-family: sans-serif;
            background: var(--bg);
            color: white;
            padding: 20px;
        }

        h2 {
            border-bottom: 2px solid #334155;
            padding-bottom: 10px;
            margin-top: 30px;
            color: #64748b;
            font-size: 1rem;
            text-transform: uppercase;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        /* Temperature Cards */
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            width: 220px;
            border-left: 5px solid #22c55e; /* Green for temp */
        }

        /* System Health Cards - Smaller and subtle */
        .system-card {
            background: #1e293b;
            border-radius: 8px;
            padding: 15px;
            width: 180px;
            border-left: 5px solid #64748b;
            font-size: 0.9rem;
        }

        .label {
            color: var(--system-text);
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .unit {
            font-size: 1rem;
            color: #475569;
            margin-left: 5px;
        }

        .small-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }
    </style>
</head>
<body>

<h2>üå°Ô∏è Environment Sensors</h2>
<div id="temp-grid" class="grid"></div>

<h2>üñ•Ô∏è System Health (Mac/Pi)</h2>
<div id="sys-grid" class="grid"></div>

<script>
    const ws = new WebSocket(`ws://${window.location.host}/ws`);
    const tempGrid = document.getElementById('temp-grid');
    const sysGrid = document.getElementById('sys-grid');

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        tempGrid.innerHTML = '';
        sysGrid.innerHTML = '';

        // Create a temporary object to group "System" properties
        const systemMetrics = {};
        const sensorReadings = [];

        data.forEach(item => {
            if (item.sensor === "System") {
                systemMetrics[item.prop] = item.temp;
            } else {
                sensorReadings.push(item);
            }
        });

        // 1. Render Temperature Cards (as before)
        sensorReadings.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                    <div class="label">${item.sensor}</div>
                    <div class="value">${item.temp.toFixed(1)}<span class="unit">¬∞C</span></div>
                `;
            tempGrid.appendChild(div);
        });

        // 2. Render Detailed System Cards
        if (systemMetrics["RAM Total GB"]) {
            renderSystemCard("üß† Memory (RAM)",
                systemMetrics["RAM Usage %"],
                `${systemMetrics["RAM Used GB"]} / ${systemMetrics["RAM Total GB"]} GB`);

            renderSystemCard("üíæ Storage (Disk)",
                systemMetrics["Disk Usage %"],
                `${systemMetrics["Disk Used GB"]} / ${systemMetrics["Disk Total GB"]} GB`);

            renderSystemCard("‚ö° CPU Load",
                systemMetrics["CPU Load 1m"] * 10, // Visual bar helper
                `Load Avg: ${systemMetrics["CPU Load 1m"].toFixed(2)}`);
        }
    };

    function renderSystemCard(title, pct, detail) {
        const div = document.createElement('div');
        div.className = 'system-card';
        div.style.width = "250px";
        div.innerHTML = `
                <div class="label">${title}</div>
                <div class="small-value">${pct.toFixed(1)}%</div>
                <div style="background: #334155; height: 8px; border-radius: 4px; margin: 10px 0;">
                    <div style="background: var(--accent); width: ${Math.min(pct, 100)}%; height: 100%; border-radius: 4px;"></div>
                </div>
                <div style="font-size: 0.8rem; color: #64748b;">${detail}</div>
            `;
        sysGrid.appendChild(div);
    }
</script>
</body>
</html>